<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Music data extraction · JuliaMusic</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/logo.ico" rel="icon" type="image/x-icon"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="JuliaMusic logo"/></a><div class="docs-package-name"><span class="docs-autofit">JuliaMusic</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../midi/io/">Basic MIDI structures</a></li><li><a class="tocitem" href="../../midi/notes/">Notes</a></li><li><a class="tocitem" href="../notetools/">Note Tools</a></li><li><a class="tocitem" href="../quantizing/">Quantizing</a></li><li class="is-active"><a class="tocitem" href>Music data extraction</a><ul class="internal"><li><a class="tocitem" href="#Basic-Data-Extraction-1"><span>Basic Data Extraction</span></a></li><li><a class="tocitem" href="#Advanced-Data-Extraction-1"><span>Advanced Data Extraction</span></a></li><li><a class="tocitem" href="#Timeseries-1"><span>Timeseries</span></a></li><li><a class="tocitem" href="#Segmentation-1"><span>Segmentation</span></a></li></ul></li><li><span class="tocitem">Visualization</span><ul><li><a class="tocitem" href="../../printplot/noteplotter/">Plotting notes</a></li><li><a class="tocitem" href="../../printplot/musescore/">Printing notes into a score</a></li></ul></li><li><span class="tocitem">Motif sequence</span><ul><li><a class="tocitem" href="../../motif/basic/">Motif sequence generator</a></li><li><a class="tocitem" href="../../motif/musicexample/">Music motifs</a></li></ul></li><li><span class="tocitem">Becoming a better drummer blog</span><ul><li><a class="tocitem" href="../../blog/drumpatterns/">Ep. 1 - Mixing drum patterns</a></li><li><a class="tocitem" href="../../blog/garibaldi_dragadiddle/">Ep. 2 - Garibaldi inspired dragaddidle</a></li><li><a class="tocitem" href="../../blog/gaddisms/">Ep. 3 - Gaddisms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Music data extraction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Music data extraction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMusic/JuliaMusic_documentation.jl/blob/master/docs/src/mm/extraction.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Music-data-extraction-1"><a class="docs-heading-anchor" href="#Music-data-extraction-1">Music data extraction</a><a class="docs-heading-anchor-permalink" href="#Music-data-extraction-1" title="Permalink"></a></h1><p>The functions described in this page allow for easier extraction of data from music recordings (in the form of MIDI). A highlight of JuliaMusic is the <a href="#MusicManipulations.timeseries"><code>timeseries</code></a> function, which allows one to directly get gridded timeseries from arbitrary <code>Notes</code> structures.</p><h2 id="Basic-Data-Extraction-1"><a class="docs-heading-anchor" href="#Basic-Data-Extraction-1">Basic Data Extraction</a><a class="docs-heading-anchor-permalink" href="#Basic-Data-Extraction-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.firstnotes" href="#MusicManipulations.firstnotes"><code>MusicManipulations.firstnotes</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">firstnotes(notes, grid)</code></pre><p>Return the notes that first appear in each grid point, <em>without quantizing them</em>.</p><p>This function <em>does not</em> consider the notes modulo the quarter note! Different quarter notes have different grid points.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.filterpitches" href="#MusicManipulations.filterpitches"><code>MusicManipulations.filterpitches</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">filterpitches(notes::Notes, filters) -&gt; newnotes</code></pre><p>Only keep the notes that have a pitch specified in <code>filters</code> (one or many pitches).</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.separatepitches" href="#MusicManipulations.separatepitches"><code>MusicManipulations.separatepitches</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">separatepitches(notes::Notes [, allowed])</code></pre><p>Get a dictionary &quot;pitch&quot;=&gt;&quot;notes of that pitch&quot;. Optionally only keep pitches that are contained in <code>allowed</code>.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.combine" href="#MusicManipulations.combine"><code>MusicManipulations.combine</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">combine(note_container) -&gt; notes</code></pre><p>Combine the given container (either <code>Array{Notes}</code> or <code>Dict{Any, Notes}</code>) into a single <code>Notes</code> instance. In the process, sort the notes by position in the final container.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.relpos" href="#MusicManipulations.relpos"><code>MusicManipulations.relpos</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">relpos(notes::Notes, grid)</code></pre><p>Return the <em>relative</em> positions of the notes with respect to the current <code>grid</code>, i.e. all notes are brought within one quarter note.</p></div></section></article><h2 id="Advanced-Data-Extraction-1"><a class="docs-heading-anchor" href="#Advanced-Data-Extraction-1">Advanced Data Extraction</a><a class="docs-heading-anchor-permalink" href="#Advanced-Data-Extraction-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.estimate_delay" href="#MusicManipulations.estimate_delay"><code>MusicManipulations.estimate_delay</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">estimate_delay(notes, grid)</code></pre><p>Estimate the average temporal deviation of the given <code>notes</code> from the quarter note grid point. The notes are classified according to the <code>grid</code> and only notes in the first and last grid bins are used. Their position is subtracted from the nearby quarter note and the returned value is the average of this operation.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.estimate_delay_recursive" href="#MusicManipulations.estimate_delay_recursive"><code>MusicManipulations.estimate_delay_recursive</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">estimate_delay_recursive(notes, grid, m)</code></pre><p>Do the same as <a href="#MusicManipulations.estimate_delay"><code>estimate_delay</code></a> but for <code>m</code> times, while in each step shifting the notes by the previously found delay. This improves the accuracy of the algorithm, because the distribution of the quarter notes is estimated better and better each time. The function should typically converge after a couple of <code>m</code>.</p><p>The returned result is the estimated delay, in integer (ticks), as only integers can be used to actually shift the notes around.</p></div></section></article><h2 id="Timeseries-1"><a class="docs-heading-anchor" href="#Timeseries-1">Timeseries</a><a class="docs-heading-anchor-permalink" href="#Timeseries-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.timeseries" href="#MusicManipulations.timeseries"><code>MusicManipulations.timeseries</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">timeseries(notes::Notes, property::Symbol, f, grid; segmented = false) -&gt; tvec, ts</code></pre><p>Produce a timeseries of the <code>property</code> of the given notes, by first quantizing on the given <code>grid</code> (to avoid actual quantization use the grid <code>0:1//notes.tpq:1</code>). Return the time vector <code>tvec</code> in ticks and the produced timeseries <code>ts</code>.</p><p>After quantization, it is often the case that many notes are in the same bin of the grid. The <strong>function</strong> <code>f</code> denotes which value of the vector of the <code>property</code> of the notes to keep. Typical values are <code>minimum, maximum, mean</code>, etc. Notice that bins without any note in them obtain the value <code>missing</code>, regardless of the function <code>f</code> or the <code>property</code>.</p><p>If the <code>property</code> is <code>:velocity</code>, <code>:pitch</code>, or <code>:duration</code> the function behaves exactly as described. The <code>property</code> can also be <code>:position</code>. In this case, the timeseries <code>ts</code> contain the timing deviations of the notes with respect to the <code>tvec</code> vector (these numbers are known as <em>microtiming deviations</em> in the literature).</p><p>If &#39;segmented = true&#39;, the notes are segmented according to the grid in order to respect the information of their duration, see <a href="#MusicManipulations.segment"><code>segment</code></a>. Otherwise the notes are treated as point events with no duration (it makes no sense to choose <code>:duration</code> with <code>segmented</code>).</p></div></section><section><div><pre><code class="language-none">timeseries(notes::Notes, f, grid) -&gt; tvec, ts</code></pre><p>If <code>property</code> is not given, then <code>f</code> should take as input a <code>Notes</code> instance and output a numeric value. This is useful for example in cases where one would want the timeseries of the velocities of the notes of the highest pitch.</p></div></section></article><hr/><p>Here is an example:</p><pre><code class="language-julia">using MusicManipulations, PyPlot, Statistics
midi = readMIDIFile(testmidi())
notes = getnotes(midi, 4)

swung_8s = [0, 2//3, 1]
t, vel = timeseries(notes, :velocity, mean, swung_8s)

notmiss = findall(!ismissing, vel)

fig, (ax1, ax2) = subplots(2,1)
ax1.scatter(t[notmiss], vel[notmiss])
ax1.set_ylabel(&quot;velocity&quot;)

t, mtd = timeseries(notes, :position, mean, swung_8s)
ax2.scatter(t[notmiss], mtd[notmiss], color = &quot;C1&quot;)
ax2.set_ylabel(&quot;timing deviations&quot;)
ax2.set_xlabel(&quot;ticks&quot;)</code></pre><p><img src="../timeseries.png" alt/></p><hr/><p>An example code that obtains the velocity of the notes with highest pitch in each bin is this one:</p><pre><code class="language-julia">notes = getnotes(midi, 4)

function f(notes)
    m, i = findmax(pitches(notes))
    notes[i].velocity
end

grid = 0:1//3:1
tvec2, ts2 = timeseries(notes, f, grid)</code></pre><h2 id="Segmentation-1"><a class="docs-heading-anchor" href="#Segmentation-1">Segmentation</a><a class="docs-heading-anchor-permalink" href="#Segmentation-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MusicManipulations.segment" href="#MusicManipulations.segment"><code>MusicManipulations.segment</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">segment(notes, grid) → segmented_notes</code></pre><p>Quantize the positions and durations of <code>notes</code> and then segment them (i.e. cut them into pieces) according to the duration of a grid unit. This function only works with <code>AbstractRange</code> grids, i.e. equi-spaced grids like <code>0:1//3:1</code>.</p></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quantizing/">« Quantizing</a><a class="docs-footer-nextpage" href="../../printplot/noteplotter/">Plotting notes »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 16 February 2020 16:48">Sunday 16 February 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
