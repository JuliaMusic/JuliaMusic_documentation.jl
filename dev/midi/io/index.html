<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic MIDI structures · JuliaMusic</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/logo.ico" rel="icon" type="image/x-icon"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="JuliaMusic logo"/></a><div class="docs-package-name"><span class="docs-autofit">JuliaMusic</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Basic MIDI structures</a><ul class="internal"><li><a class="tocitem" href="#MIDIFile-1"><span><code>MIDIFile</code></span></a></li><li><a class="tocitem" href="#MIDITrack-1"><span><code>MIDITrack</code></span></a></li><li><a class="tocitem" href="#Utility-functions-1"><span>Utility functions</span></a></li><li><a class="tocitem" href="#Low-Level-API-1"><span>Low-Level API</span></a></li><li><a class="tocitem" href="#MIDI:-The-least-you-need-to-know-1"><span>MIDI: The least you need to know</span></a></li></ul></li><li><a class="tocitem" href="../notes/">Notes</a></li><li><a class="tocitem" href="../../mm/notetools/">Note Tools</a></li><li><a class="tocitem" href="../../mm/quantizing/">Quantizing</a></li><li><a class="tocitem" href="../../mm/extraction/">Music data extraction</a></li><li><span class="tocitem">Visualization</span><ul><li><a class="tocitem" href="../../printplot/noteplotter/">Plotting notes</a></li><li><a class="tocitem" href="../../printplot/musescore/">Printing notes into a score</a></li></ul></li><li><span class="tocitem">Motif sequence</span><ul><li><a class="tocitem" href="../../motif/basic/">Motif sequence generator</a></li><li><a class="tocitem" href="../../motif/musicexample/">Music motifs</a></li></ul></li><li><span class="tocitem">Becoming a better drummer blog</span><ul><li><a class="tocitem" href="../../blog/drumpatterns/">Ep. 1 - Mixing drum patterns</a></li><li><a class="tocitem" href="../../blog/garibaldi_dragadiddle/">Ep. 2 - Garibaldi inspired dragaddidle</a></li><li><a class="tocitem" href="../../blog/gaddisms/">Ep. 3 - Gaddisms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Basic MIDI structures</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic MIDI structures</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMusic/JuliaMusic_documentation.jl/blob/master/docs/src/midi/io.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-MIDI-structures-1"><a class="docs-heading-anchor" href="#Basic-MIDI-structures-1">Basic MIDI structures</a><a class="docs-heading-anchor-permalink" href="#Basic-MIDI-structures-1" title="Permalink"></a></h1><p>MIDI files are loaded to/from disc and transformed into a Julia structure <code>MIDIFile</code>, which contains <code>MIDITrack</code>s.</p><h2 id="MIDIFile-1"><a class="docs-heading-anchor" href="#MIDIFile-1"><code>MIDIFile</code></a><a class="docs-heading-anchor-permalink" href="#MIDIFile-1" title="Permalink"></a></h2><p>To read and write a MIDI file, use</p><article class="docstring"><header><a class="docstring-binding" id="MIDI.readMIDIFile" href="#MIDI.readMIDIFile"><code>MIDI.readMIDIFile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">readMIDIFile(filename::AbstractString)</code></pre><p>Read a file into a <code>MIDIFile</code> data type.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.writeMIDIFile" href="#MIDI.writeMIDIFile"><code>MIDI.writeMIDIFile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">writeMIDIFile(filename::AbstractString, data::MIDIFile)</code></pre><p>Write a <code>MIDIFile</code> as a &quot;.mid&quot; file to the given filename.</p><pre><code class="language-none">writeMIDIFile(filename::AbstractString, notes::Notes)</code></pre><p>Create a <code>MIDIFile</code> directly from <code>notes</code>, using format 1.</p></div></section></article><hr/><p>The above functions return / use the <code>MIDIFile</code> type:</p><article class="docstring"><header><a class="docstring-binding" id="MIDI.MIDIFile" href="#MIDI.MIDIFile"><code>MIDI.MIDIFile</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">MIDIFile &lt;: Any</code></pre><p>Type representing a file of MIDI data.</p><p><strong>Fields</strong></p><ul><li><code>format::UInt16</code> : The format of the file. Can be 0, 1 or 2.</li><li><code>tpq::Int16</code> : The time division of the track, ticks-per-quarter-note.</li><li><code>tracks::Array{MIDITrack, 1}</code> : The array of contained tracks.</li></ul></div></section></article><hr/><h2 id="MIDITrack-1"><a class="docs-heading-anchor" href="#MIDITrack-1"><code>MIDITrack</code></a><a class="docs-heading-anchor-permalink" href="#MIDITrack-1" title="Permalink"></a></h2><p>The most important field of a <code>MIDIFile</code> is the <code>tracks</code> field. It contains as many tracks as the user wants. The tracks themselves contain all &quot;musical&quot; information in the form of the &quot;events&quot; we mentioned in <a href="#MIDI:-The-least-you-need-to-know-1">MIDI: The least you need to know</a>.</p><article class="docstring"><header><a class="docstring-binding" id="MIDI.MIDITrack" href="#MIDI.MIDITrack"><code>MIDI.MIDITrack</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">MIDITrack &lt;: Any</code></pre><p><code>MIDITrack</code> is simply a container for <code>TrackEvents</code>, since its only field is <code>events::Vector{TrackEvent}</code>.</p><p>Track chunks begin with four bytes spelling out &quot;MTrk&quot;, followed by the length (in bytes) of the track (see <a href="#MIDI.readvariablelength"><code>readvariablelength</code></a>), followed by a sequence of events.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.TrackEvent" href="#MIDI.TrackEvent"><code>MIDI.TrackEvent</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">TrackEvent &lt;: Any</code></pre><p>Abstract supertype for all MIDI events.</p><p>All track events begin with a variable length time value (see <a href="#MIDI.readvariablelength"><code>readvariablelength</code></a>) and have a field named <code>dT</code> which contains it. This number notes after how many ticks since the last event does the current even takes place.</p><p><code>MIDIEvent</code>s then resume with a MIDI channel message defined in <code>constants.jl</code>. They&#39;re followed by 1 or 2 bytes, depending on the channel message (see <code>MIDI.EVENTTYPETOLENGTH</code>). If no valid channel message is identified, the previous seen channel message is used. After that the MIDI command is encoded.</p><p><code>MetaEvent</code>s and <code>SysexEvent</code>s both resume with a specific byte (see <code>constants.jl</code>).</p></div></section></article><hr/><p>The <code>TrackEvent</code> themselves can be one of three types:</p><pre><code class="language-julia">struct MIDIEvent &lt;: TrackEvent
    dT::Int
    status::UInt8
    data::Array{UInt8,1}
end

struct MetaEvent &lt;: TrackEvent
    dT::Int
    metatype::UInt8
    data::Array{UInt8,1}
end

struct SysexEvent &lt;: TrackEvent
    dT::Int
    data::Array{UInt8,1}
end</code></pre><p>Typically the most relevant information of a <code>MIDITrack</code> are the notes contained within. For this reason, special functions <a href="../notes/#MIDI.getnotes"><code>getnotes</code></a> and <a href="../notes/#MIDI.addnotes!"><code>addnotes!</code></a> exist, which can be found in the <a href="midi/notes">Notes</a> page.</p><h2 id="Utility-functions-1"><a class="docs-heading-anchor" href="#Utility-functions-1">Utility functions</a><a class="docs-heading-anchor-permalink" href="#Utility-functions-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="MIDI.BPM" href="#MIDI.BPM"><code>MIDI.BPM</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">BPM(midi)</code></pre><p>Return the BPM where the given <code>MIDIFile</code> was exported at.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.ms_per_tick" href="#MIDI.ms_per_tick"><code>MIDI.ms_per_tick</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ms_per_tick(tpq, bpm)
ms_per_tick(midi::MIDIFile)</code></pre><p>Return how many miliseconds is one tick, based on the beats per minute <code>bpm</code> and ticks per quarter note <code>tpq</code>.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.addevent!" href="#MIDI.addevent!"><code>MIDI.addevent!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">addevent!(track::MIDITrack, time::Int, event::TrackEvent)</code></pre><p>Add an event to the <code>track</code> at given <code>time</code>. The <code>time</code> is in absolute time, not relative.</p><p>If you want to add multiple events in one go, you should use the <a href="#MIDI.addevents!"><code>addevents!</code></a> function instead.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.addevents!" href="#MIDI.addevents!"><code>MIDI.addevents!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">addevents!(track::MIDITrack, times, events)</code></pre><p>Add given <code>events</code> to given <code>track</code> at given <code>times</code>, internally doing all translations from absolute time to relative time.</p><p>Using this function is more efficient than a loop over single <a href="#MIDI.addevent!"><code>addevent!</code></a> calls.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.trackname" href="#MIDI.trackname"><code>MIDI.trackname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">trackname(track::MIDI.MIDITrack)</code></pre><p>Return the name of the given <code>track</code> as a string, by finding the &quot;track name&quot; <code>MetaEvent</code>.</p><p>If no such event exists, <code>&quot;No track name found&quot;</code> is returned.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.addtrackname!" href="#MIDI.addtrackname!"><code>MIDI.addtrackname!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">addtrackname!(track::MIDI.MIDITrack, name::String)</code></pre><p>Add a name to the given <code>track</code> by attaching the &quot;track name&quot; <code>MetaEvent</code> to the start of the <code>track</code>.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.textevent" href="#MIDI.textevent"><code>MIDI.textevent</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">textevent(eventtype, text)</code></pre><p>Create an event using the string <code>text</code>. The <code>eventtype</code> can be <code>:text, :lyric, :marker</code>, which will create the appropriate type of <code>MetaEvent</code>.</p><p>The returned event can be added to a <a href="#MIDI.MIDITrack"><code>MIDITrack</code></a> via either <a href="#MIDI.addevent!"><code>addevent!</code></a> or <a href="#MIDI.addevents!"><code>addevents!</code></a> for multiple events.</p><p><em>Notice</em> - Cubase can read the marker events and MuseScore can read the lyrics events. We haven&#39;t seen any editor that can read the text events, so far.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="MIDI.findtextevents" href="#MIDI.findtextevents"><code>MIDI.findtextevents</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">findtextevents(eventtype, track)</code></pre><p>Find all &quot;text&quot; events specifield by <code>eventtype</code> in the <code>track</code>. The <code>eventtype</code> can be <code>:text, :lyric, :marker</code>, which will find the appropriate <code>MetaEvent</code>s.</p><p>For convenience, this function does not return the events themselves. Instead, it returns three vectors: the first is the strings of the events, the second is the indices of the events in the <code>track</code> and the third is the absolute position of the events (since start of <code>track</code>).</p><p><em>Notice</em> - common music score editors like e.g. MuseScore, GuitarPro, etc., do not export the lyrics and text information when exporting midi files.</p></div></section></article><h2 id="Low-Level-API-1"><a class="docs-heading-anchor" href="#Low-Level-API-1">Low-Level API</a><a class="docs-heading-anchor-permalink" href="#Low-Level-API-1" title="Permalink"></a></h2><p>In this section we show the low-level API that allows one to actually read bytes from a file and transform them into Julia structures.</p><article class="docstring"><header><a class="docstring-binding" id="MIDI.readvariablelength" href="#MIDI.readvariablelength"><code>MIDI.readvariablelength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">readvariablelength(f::IO)</code></pre><p>Variable length numbers in MIDI files are represented as a sequence of bytes. If the first bit is 0, we&#39;re looking at the last byte in the sequence. The remaining 7 bits indicate the number.</p></div></section></article><p>Other useful functions that are not exported are</p><pre><code class="language-julia">writeevent
readMIDIevent
readmetaevent
readsysexevent
get_abs_pos</code></pre><hr/><p>Lastly, see the file <code>MIDI/src/constants.jl</code> for message types, event types, etc.</p><h2 id="MIDI:-The-least-you-need-to-know-1"><a class="docs-heading-anchor" href="#MIDI:-The-least-you-need-to-know-1">MIDI: The least you need to know</a><a class="docs-heading-anchor-permalink" href="#MIDI:-The-least-you-need-to-know-1" title="Permalink"></a></h2><p><em>This section serves as a crash-course on the MIDI format. For more info see the <a href="https://en.wikipedia.org/wiki/MIDI">wikipedia</a> page, read the <a href="https://www.midi.org/specifications">official MIDI specifications</a> or have a look at the comprehensive tutorial <a href="http://www.recordingblogs.com/wiki/musical-instrument-digital-interface-midi">at recordingblogs.com</a></em>.</p><p>A MIDI file typically comes in pieces called tracks that play simultaneously. Each track can have 16 different channels, numbered 0-15. Each channel can be thought of as a single instrument, though that instrument can be changed throughout that track. A track contains events. The three types of events are MIDI events, META events, and system exclusive (SYSEX) events. All events begin with the time since the last event (dT) in ticks. The number of ticks per quarter note is given by the <code>tpq</code> of the midi file, <code>MIDIFile.tpq</code> (see <a href="#MIDI.MIDIFile"><code>MIDIFile</code></a>).</p><ul><li><p>MIDI events handle things related to the actual notes as well as sound texture, such as playing a note or moving the pitch-wheel.</p></li><li><p>META events take care of things like adding copyright text, authorship information, track naming etc.</p></li><li><p>SYSEX events are used to transmit arbitrary data. Their contents depend on the intended recipient.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Introduction</a><a class="docs-footer-nextpage" href="../notes/">Notes »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 16 February 2020 16:16">Sunday 16 February 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
